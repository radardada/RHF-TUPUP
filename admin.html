<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - RHF</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Poppins', sans-serif; background: #f4f4f4; color: #333; }
    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

    header {
      background: linear-gradient(135deg, #ff6600, #ff8800);
      color: white;
      padding: 50px 20px;
      text-align: center;
      border-radius: 0 0 30px 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    header h1 { font-size: 42px; margin-bottom: 8px; }
    header p { font-size: 18px; opacity: 0.9; }

    .admin-section {
      background: white;
      border-radius: 20px;
      padding: 35px;
      margin: 30px 0;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
    }
    .section-title {
      font-size: 30px;
      color: #ff6600;
      border-bottom: 4px solid #ff6600;
      padding-bottom: 12px;
      margin-bottom: 25px;
      display: inline-block;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    th, td {
      padding: 16px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    th {
      background: #fff8f0;
      color: #ff6600;
      font-weight: 600;
    }
    tr:hover { background: #fffaf5; }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
      margin: 5px;
    }
    .btn-add { background: #28a745; }
    .btn-add:hover { background: #218838; }
    .btn-success { background: #17a2b8; }
    .btn-success:hover { background: #138496; }
    .btn-danger { background: #dc3545; }
    .btn-danger:hover { background: #c82333; }
    .btn-warning { background: #ffc107; color: #333; }
    .btn-warning:hover { background: #e0a800; }

    form {
      display: grid;
      gap: 15px;
      max-width: 600px;
    }
    input, textarea {
      padding: 14px;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
    }
    textarea { min-height: 100px; }

    .preview-img {
      max-width: 180px;
      border-radius: 10px;
      margin-top: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .count-badge {
      background: #ff6600;
      color: white;
      padding: 8px 16px;
      border-radius: 30px;
      font-weight: 600;
      margin-bottom: 20px;
      display: inline-block;
    }

    footer {
      text-align: center;
      padding: 40px 20px;
      color: #777;
      margin-top: 60px;
    }
  </style>
</head>
<body>

  <header>
    <h1>Admin Dashboard RHF</h1>
    <p>Kelola User, Saldo, Topup Requests, Pesanan, dan Event Carousel Secara Real-Time</p>
  </header>

  <div class="container">

    <!-- Topup Requests -->
    <div class="admin-section">
      <div class="section-title">Permintaan Topup Saldo</div>
      <div class="count-badge" id="topupCount">Memuat...</div>
      <table id="topupTable">
        <thead>
          <tr>
            <th>No</th>
            <th>Waktu</th>
            <th>User ID</th>
            <th>Nominal</th>
            <th>Deskripsi</th>
            <th>Bukti</th>
            <th>Status</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Pesanan Top Up Game -->
    <div class="admin-section">
      <div class="section-title">Pesanan Top Up Game</div>
      <table id="ordersTable">
        <thead>
          <tr>
            <th>No</th>
            <th>Waktu</th>
            <th>User ID</th>
            <th>Game</th>
            <th>Nominal</th>
            <th>Harga</th>
            <th>Status</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Kelola User & Saldo -->
    <div class="admin-section">
      <div class="section-title">Kelola User & Saldo</div>
      <table id="userTable">
        <thead>
          <tr>
            <th>No</th>
            <th>Nama/Email</th>
            <th>User ID</th>
            <th>Saldo</th>
            <th>Status</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Kelola Event Carousel -->
    <div class="admin-section">
      <div class="section-title">Kelola Event Carousel</div>
      <button class="btn btn-add" onclick="toggleEventForm()">+ Tambah Event Baru</button>
      <div id="eventForm" style="display:none; margin:20px 0;">
        <input type="text" id="eventTitle" placeholder="Judul Event" required>
        <textarea id="eventDesc" placeholder="Deskripsi Event" required></textarea>
        <input type="url" id="eventImage" placeholder="URL Gambar (https://...)" required>
        <img id="eventImagePreview" class="preview-img" src="" alt="Preview" style="display:none;">
        <button class="btn btn-success" onclick="addEvent()">Simpan Event</button>
      </div>
      <table id="eventTable">
        <thead>
          <tr>
            <th>No</th>
            <th>Judul</th>
            <th>Deskripsi</th>
            <th>Gambar</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

  </div>

  <footer>
    <p>Â© 2026 RHF Admin Panel - Semua data real-time dari Firebase</p>
  </footer>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyALIhKFz4bpOPmES6t2fAdx8VMPP0ye1wc",
      authDomain: "rhf-resmi.firebaseapp.com",
      databaseURL: "https://rhf-resmi-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "rhf-resmi",
      storageBucket: "rhf-resmi.appspot.com",
      messagingSenderId: "313439235544",
      appId: "1:313439235544:web:b19a2ad538e34c1fe516ad",
      measurementId: "G-LNCVH73P3X"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Topup Requests
    function loadTopupRequests() {
      db.ref('topup_requests').orderByChild('timestamp').on('value', snap => {
        const tbody = document.querySelector('#topupTable tbody');
        tbody.innerHTML = '';
        const count = document.getElementById('topupCount');
        let total = 0;
        const requests = snap.val() || {};
        Object.keys(requests).forEach(key => {
          total++;
          const r = requests[key];
          const date = new Date(r.timestamp).toLocaleString('id-ID');
          const status = r.status || 'Pending';
          const row = `
            <tr>
              <td>${total}</td>
              <td>${date}</td>
              <td>${r.uid}</td>
              <td>Rp ${r.nominal.toLocaleString('id-ID')}</td>
              <td>${r.desc || '-'}</td>
              <td><a href="${r.bukti}" target="_blank">Lihat Bukti</a></td>
              <td>${status}</td>
              <td>
                \( {status === 'Pending' ? `<button class="btn btn-success" onclick="confirmTopup(' \){key}', \( {r.nominal}, ' \){r.uid}')">Konfirmasi</button>` : ''}
                <button class="btn btn-danger" onclick="deleteTopup('${key}')">Hapus</button>
              </td>
            </tr>`;
          tbody.innerHTML += row;
        });
        count.textContent = `Total: ${total}`;
      });
    }

    function confirmTopup(key, nominal, uid) {
      if (confirm(`Tambah Rp ${nominal.toLocaleString('id-ID')} ke user ${uid}?`)) {
        db.ref('users/' + uid + '/saldo').transaction(s => (s || 0) + nominal);
        db.ref('topup_requests/' + key + '/status').set('Success');
      }
    }

    function deleteTopup(key) {
      if (confirm('Hapus permintaan?')) db.ref('topup_requests/' + key).remove();
    }

    // Pesanan Game
    function loadOrders() {
      db.ref('orders').orderByChild('timestamp').on('value', snap => {
        const tbody = document.querySelector('#ordersTable tbody');
        tbody.innerHTML = '';
        let no = 1;
        const orders = snap.val() || {};
        Object.keys(orders).forEach(key => {
          const o = orders[key];
          const date = new Date(o.timestamp).toLocaleString('id-ID');
          const row = `
            <tr>
              <td>${no++}</td>
              <td>${date}</td>
              <td>${o.uid || '-'}</td>
              <td>${o.game || '-'}</td>
              <td>${o.nominal || '-'}</td>
              <td>Rp ${(o.harga || 0).toLocaleString('id-ID')}</td>
              <td>${o.status || 'Menunggu'}</td>
              <td>
                <button class="btn btn-success" onclick="updateOrderStatus('${key}', 'Berhasil')">Berhasil</button>
                <button class="btn btn-danger" onclick="updateOrderStatus('${key}', 'Gagal')">Gagal</button>
              </td>
            </tr>`;
          tbody.innerHTML += row;
        });
      });
    }

    function updateOrderStatus(key, status) {
      db.ref('orders/' + key + '/status').set(status);
    }

    // Users
    function loadUsers() {
      db.ref('users').on('value', snap => {
        const tbody = document.querySelector('#userTable tbody');
        tbody.innerHTML = '';
        let no = 1;
        snap.forEach(child => {
          const key = child.key;
          const u = child.val();
          const row = `
            <tr>
              <td>${no++}</td>
              <td>${u.username || u.email || '-'}</td>
              <td>${key}</td>
              <td>Rp ${(u.saldo || 0).toLocaleString('id-ID')}</td>
              <td>${u.frozen ? 'Dibekukan' : 'Aktif'}</td>
              <td>
                <button class="btn btn-add-saldo" onclick="addSaldo('${key}')">+ Saldo</button>
                <button class="btn btn-cut-saldo" onclick="cutSaldo('${key}')">- Saldo</button>
                <button class="btn btn-warning" onclick="toggleFreeze('${key}', \( {u.frozen || false})"> \){u.frozen ? 'Aktifkan' : 'Bekukan'}</button>
              </td>
            </tr>`;
          tbody.innerHTML += row;
        });
      });
    }

    function addSaldo(key) {
      const amt = prompt('Tambah saldo (Rp):');
      if (amt && !isNaN(amt)) db.ref('users/' + key + '/saldo').transaction(s => (s || 0) + parseInt(amt));
    }

    function cutSaldo(key) {
      const amt = prompt('Potong saldo (Rp):');
      if (amt && !isNaN(amt)) db.ref('users/' + key + '/saldo').transaction(s => (s || 0) - parseInt(amt));
    }

    function toggleFreeze(key, current) {
      db.ref('users/' + key + '/frozen').set(!current);
    }

    // Events
    function loadEvents() {
      db.ref('events').on('value', snap => {
        const tbody = document.querySelector('#eventTable tbody');
        tbody.innerHTML = '';
        let no = 1;
        snap.forEach(child => {
          const key = child.key;
          const e = child.val();
          const row = `
            <tr>
              <td>${no++}</td>
              <td>${e.title || '-'}</td>
              <td>${e.desc || '-'}</td>
              <td><img src="${e.image || ''}" style="width:120px;height:auto;border-radius:8px;" onerror="this.src='https://via.placeholder.com/120'"></td>
              <td><button class="btn btn-danger" onclick="deleteEvent('${key}')">Hapus</button></td>
            </tr>`;
          tbody.innerHTML += row;
        });
      });
    }

    function toggleEventForm() {
      const f = document.getElementById('eventForm');
      f.style.display = f.style.display === 'none' ? 'block' : 'none';
    }

    function addEvent() {
      const title = document.getElementById('eventTitle').value.trim();
      const desc = document.getElementById('eventDesc').value.trim();
      const image = document.getElementById('eventImage').value.trim();
      if (!title || !desc || !image) return alert('Lengkapi semua!');
      if (!image.startsWith('https://')) return alert('URL harus HTTPS');

      db.ref('events').push({ title, desc, image }).then(() => {
        alert('Event berhasil ditambahkan');
        toggleEventForm();
        document.getElementById('eventTitle').value = '';
        document.getElementById('eventDesc').value = '';
        document.getElementById('eventImage').value = '';
        document.getElementById('eventImagePreview').style.display = 'none';
      });
    }

    function deleteEvent(key) {
      if (confirm('Hapus event?')) db.ref('events/' + key).remove();
    }

    document.getElementById('eventImage').addEventListener('input', function() {
      const url = this.value.trim();
      const preview = document.getElementById('eventImagePreview');
      preview.src = url;
      preview.style.display = url ? 'block' : 'none';
    });

    // Load semua
    loadTopupRequests();
    loadOrders();
    loadUsers();
    loadEvents();
  </script>
</body>
</html>
